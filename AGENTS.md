# AGENTS.md - Coding Guidelines for Pinger

## Build, Test, and Lint Commands

```bash
# Development server (port 3000)
npm run dev

# Production build
npm run build

# Preview production build
npm run serve

# Run all tests
npm run test

# Run a single test file
npx vitest run src/path/to/file.test.ts

# Run tests in watch mode during development
npx vitest --watch

# Format code
npm run format

# Lint code
npm run lint

# Check (format + lint + auto-fix)
npm run check
```

## Code Style Guidelines

### Import Conventions
- Use `@/` path alias for all src imports (configured in tsconfig.json)
- Import order: React/core libs → third-party → @/lib → @/components → relative
- Use named imports where possible

### Formatting
- **Biome** is used for formatting and linting
- Indent: 4 spaces (no tabs)
- Quotes: Double
- Semicolons: As needed
- Trailing commas: None
- Organize imports: Enabled (automatic sorting)

### Naming Conventions
- **Components**: PascalCase (e.g., `Header`, `UserButton`)
- **Functions/Variables**: camelCase (e.g., `getCurrentUser`, `queryClient`)
- **Constants**: SCREAMING_SNAKE_CASE or camelCase for config objects
- **Files**: camelCase for utils, PascalCase for components
- **Database**: Drizzle schema uses plural table names

### TypeScript Guidelines
- Strict mode enabled
- Explicit return types on server functions
- Use `type` for type-only imports: `import type { User } from "better-auth"`
- No non-null assertions (overridden in biome config, but avoid)
- No unused locals/parameters (enforced by TS)

### Component Patterns
- Use React 19 with new JSX transform
- Server components: Use `createServerFn` from `@tanstack/react-start`
- Client components: Import from `@tanstack/react-router`
- Always use Tailwind classes for styling (no inline styles)
- Use `cn()` utility from `@/lib/utils` for conditional classes

### Server Functions Pattern
```typescript
import { createServerFn } from "@tanstack/react-start";
import { getRequest } from "@tanstack/react-start/server";

export const myFunction = createServerFn({ method: "GET" }).handler(async () => {
    const request = getRequest();
    // Logic here
});
```

### Error Handling
- Return null for missing data in loaders
- Use 404 components for route-level not found
- Better Auth handles auth errors automatically
- Server functions should return serializable data

### Database & Auth
- **Database**: Drizzle ORM with PostgreSQL
- **Auth**: Better Auth with UI components from @daveyplate/better-auth-ui
- Use `auth.api.getSession()` with request headers for server-side auth
- Session endpoint available at `/api/auth`

### Routing
- File-based routing with TanStack Router
- Route files in `src/routes/` using `createFileRoute()`
- Route tree auto-generated at `src/routeTree.gen.ts`
- Root layout in `src/routes/__root.tsx`
- API routes in `src/routes/api/`

### Styling
- **Tailwind CSS v4** with custom theme variables
- Use `bg-background`, `text-foreground` for theme-aware colors
- Mobile-first responsive design (touch targets min 44px)
- Container queries for component-level responsiveness

### Environment Variables
- Use `process.env.DATABASE_URL` for database connections
- All env vars accessed through dotenv in dev
- No secrets in client-side code

### Testing
- **Vitest** for unit testing
- Testing Library for React component tests
- Tests located alongside source files (e.g., `file.test.ts`)

### PWA Configuration
- Service worker auto-generated by vite-plugin-pwa
- Manifest configured in vite.config.ts
- Icons must be 192x192 and 512x512 PNG
- Theme colors: `#5865f2` (primary), `#36393f` (background)

### Git & CI/CD
- Conventional commits for semantic-release
- GitHub Actions workflow in `.github/workflows/release.yml`
- Docker image published to GHCR on release
- No AGENTS.md commit needed on every change

### Important Notes
- Never commit `.env` files or secrets
- Always run `npm run check` before committing
- Generated files (routeTree.gen.ts) should not be manually edited
- Better Auth UI components handle their own state
- TanStack Router handles data loading and caching automatically
